create trigger dbo.tr_Basket_insert_update on dbo.Basket
after insert
as
begin
  if (select count(*) from inserted as i group by ID_SKU having count(*) >= 2) > 0
	begin
		update b
		set DiscountValue = Value * 0.05
		from dbo.Basket as b
			inner join inserted as i on i.ID = b.ID
			inner join (
				select ID_SKU
				from inserted as i
				group by ID_SKU
				having count(*) >= 2
			) as a on a.ID_SKU = b.ID_SKU
	end
	else
	begin
		update b
		set DiscountValue = 0
		from dbo.Basket as b
		where b.ID in (select i.ID from inserted as i)
	end
end;
